{"ast":null,"code":"import _regeneratorRuntime from\"/Users/hyeonghan/VSCode/React/Serendy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/hyeonghan/VSCode/React/Serendy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/hyeonghan/VSCode/React/Serendy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/hyeonghan/VSCode/React/Serendy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import{action,computed,makeObservable,observable}from\"mobx\";import serendyRepository from'../repository/serendyRepository';var UserStore=/*#__PURE__*/function(){function UserStore(){_classCallCheck(this,UserStore);this._isSignIn=false;this._user=null;this._isLogging=false;this._userSocket=null;this._socketID=null;makeObservable(this,{_isLogging:observable,_isSignIn:observable,_user:observable,_userSocket:observable,_socketID:observable,isLogging:computed,isSignIn:computed,user:computed,userSocket:computed,socketID:computed,setIsSignIn:action,setUser:action,signInWithToken:action,signIn:action,signOut:action,changePW:action,setIsLogging:action,setUserSocket:action,setSocketID:action});}_createClass(UserStore,[{key:\"isSignIn\",get:function get(){return this._isSignIn;}},{key:\"user\",get:function get(){return this._user;}},{key:\"isLogging\",get:function get(){return this._isLogging;}},{key:\"userSocket\",get:function get(){return this._userSocket;}},{key:\"socketID\",get:function get(){return this._socketID;}},{key:\"setIsSignIn\",value:function setIsSignIn(status){this._isSignIn=status;}},{key:\"setUser\",value:function setUser(user){this._user=user;}},{key:\"setIsLogging\",value:function setIsLogging(boolean){this._isLogging=boolean;}},{key:\"setUserSocket\",value:function setUserSocket(data){this._userSocket=data;}},{key:\"setSocketID\",value:function setSocketID(myID){this._socketID=myID;}},{key:\"saveSocketID\",value:function saveSocketID(){var _this$userSocket,_this$userSocket2,_this=this;(_this$userSocket=this.userSocket)===null||_this$userSocket===void 0?void 0:_this$userSocket.emit('enter');(_this$userSocket2=this.userSocket)===null||_this$userSocket2===void 0?void 0:_this$userSocket2.on('entered',function(myID){_this.setSocketID(myID);});}// 유효한 토큰을 가지고 있을 시 로그인을 유지하며 새로운 토큰을 발급받아 저장 (expiresIn 30m)\n// 서버쪽 토큰 유효성검사를 하는 미들웨어에서 토큰이 만료되었거나 없으면 403을 띄우면서 종료되어서\n// App 컴포넌트에서 쓰이는 이 메소드와 아래의 signIn 메소드를 따로 분리해서 만들었음.\n},{key:\"signInWithToken\",value:function(){var _signInWithToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.setIsLogging(true);_context.prev=1;token=localStorage.getItem('SerendyToken');if(token){_context.next=8;break;}this.setIsLogging(false);return _context.abrupt(\"return\");case 8:if(!token){_context.next=18;break;}_context.next=11;return serendyRepository.signInWidthToken();case 11:response=_context.sent;if(!(response.data.message==='Invalid Token')){_context.next=17;break;}// 토큰만료 또는 없음\nthis.setIsLogging(false);return _context.abrupt(\"return\");case 17:if(response.data.message==='SignIn Success'){this.setUser({account:response.data.account,nickName:response.data.nickName});this.setIsSignIn(true);localStorage.setItem('SerendyToken',response.data.token);this.setIsLogging(false);}case 18:_context.next=24;break;case 20:_context.prev=20;_context.t0=_context[\"catch\"](1);this.setIsLogging(false);alert('서버 점검중입니다');case 24:case\"end\":return _context.stop();}}},_callee,this,[[1,20]]);}));function signInWithToken(){return _signInWithToken.apply(this,arguments);}return signInWithToken;}()},{key:\"signIn\",value:function(){var _signIn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(userData,setError,push){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.setIsLogging(true);_context2.prev=1;_context2.next=4;return serendyRepository.signIn(userData);case 4:response=_context2.sent;if(response.data.message==='SignIn Fail'){this.setIsLogging(false);setError();}else if(response.data.message==='SignIn Success'){this.setUser({account:response.data.account,nickName:response.data.nickName});this.setIsSignIn(true);localStorage.setItem('SerendyToken',response.data.token);this.setIsLogging(false);push();}_context2.next=13;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.log(5);this.setIsLogging(false);alert('서버 점검중입니다');case 13:case\"end\":return _context2.stop();}}},_callee2,this,[[1,8]]);}));function signIn(_x,_x2,_x3){return _signIn.apply(this,arguments);}return signIn;}()},{key:\"signOut\",value:function signOut(push){this.setIsSignIn(false);this.setUser({account:null,nickName:null});localStorage.removeItem('SerendyToken');push();}},{key:\"changePW\",value:function(){var _changePW=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data,push){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return serendyRepository.changePassword(data);case 3:response=_context3.sent;if(response.data.message==='Changed'){alert(\"\\uBE44\\uBC00\\uBC88\\uD638\\uAC00 \\uBCC0\\uACBD\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4\\n\\uB2E4\\uC2DC \\uB85C\\uADF8\\uC778 \\uD574\\uC8FC\\uC138\\uC694\");this.signOut(push);}_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);alert('서버가 점검중이에요');case 10:;case 11:case\"end\":return _context3.stop();}}},_callee3,this,[[0,7]]);}));function changePW(_x4,_x5){return _changePW.apply(this,arguments);}return changePW;}()},{key:\"changeName\",value:function(){var _changeName=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(nickName,push){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return serendyRepository.changeName(nickName);case 3:response=_context4.sent;if(response.data.message==='Changed'){alert(\"\\uB2C9\\uB124\\uC784\\uC774 \\uBCC0\\uACBD\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4\\n\\uB2E4\\uC2DC \\uB85C\\uADF8\\uC778 \\uD574\\uC8FC\\uC138\\uC694\");this.signOut(push);}_context4.next=11;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);alert('서버가 점검중이에요');case 11:;case 12:case\"end\":return _context4.stop();}}},_callee4,this,[[0,7]]);}));function changeName(_x6,_x7){return _changeName.apply(this,arguments);}return changeName;}()}]);return UserStore;}();;var userStore=new UserStore();export default userStore;","map":{"version":3,"sources":["/Users/hyeonghan/VSCode/React/Serendy/client/src/store/userStore.ts"],"names":["action","computed","makeObservable","observable","serendyRepository","UserStore","_isSignIn","_user","_isLogging","_userSocket","_socketID","isLogging","isSignIn","user","userSocket","socketID","setIsSignIn","setUser","signInWithToken","signIn","signOut","changePW","setIsLogging","setUserSocket","setSocketID","status","boolean","data","myID","emit","on","token","localStorage","getItem","signInWidthToken","response","message","account","nickName","setItem","alert","userData","setError","push","console","log","removeItem","changePassword","changeName","userStore"],"mappings":"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","sourcesContent":["import { action, computed, makeObservable, observable } from \"mobx\";\nimport { ISignInData } from '../components/SignIn/SignInBox';\nimport { IPassword } from '../components/MyPage/ChangePWBox';\nimport serendyRepository from '../repository/serendyRepository';\nimport { Socket } from 'socket.io-client';\nimport { INickName } from '../components/MyPage/ChangeNameBox';\ninterface IUser {\n    account: string | null,\n    nickName: string | null,\n}\n\ninterface IUserStore {\n    isLogging: boolean;\n    isSignIn: boolean;\n    user: IUser | null;\n    userSocket: Socket | null;\n    socketID: string | null;\n}\n\nclass UserStore implements IUserStore {\n\n    private _isSignIn: boolean = false;\n    private _user: IUser | null = null;\n    private _isLogging: boolean = false;\n    private _userSocket: Socket | null = null;\n    private _socketID: string | null = null;\n\n    constructor() {\n        makeObservable<UserStore, '_isLogging' | '_isSignIn' | '_user' | '_userSocket' | '_socketID'>(this, {\n            _isLogging: observable,\n            _isSignIn: observable,\n            _user: observable,\n            _userSocket: observable,\n            _socketID: observable,\n            isLogging: computed,\n            isSignIn: computed,\n            user: computed,\n            userSocket: computed,\n            socketID: computed,\n            setIsSignIn: action,\n            setUser: action,\n            signInWithToken: action,\n            signIn: action,\n            signOut: action,\n            changePW: action,\n            setIsLogging: action,\n            setUserSocket: action,\n            setSocketID: action,\n        })\n    }\n\n    public get isSignIn(): boolean {\n        return this._isSignIn;\n    }\n\n    public get user(): IUser | null {\n        return this._user;\n    }\n\n    public get isLogging(): boolean {\n        return this._isLogging;\n    }\n\n    public get userSocket(): Socket | null {\n        return this._userSocket;\n    }\n\n    public get socketID(): string | null {\n        return this._socketID;\n    }\n\n    public setIsSignIn(status: boolean): void {\n        this._isSignIn = status;\n    }\n\n    public setUser(user: IUser): void {\n        this._user = user;\n    }\n\n    public setIsLogging(boolean: boolean): void {\n        this._isLogging = boolean;\n    }\n\n    public setUserSocket(data: Socket | null): void {\n        this._userSocket = data;\n    }\n\n    public setSocketID(myID: string | null): void {\n        this._socketID = myID;\n    }\n\n    public saveSocketID(): void {\n        this.userSocket?.emit('enter');\n        this.userSocket?.on('entered', myID => {\n            this.setSocketID(myID);\n        });\n    }\n    // 유효한 토큰을 가지고 있을 시 로그인을 유지하며 새로운 토큰을 발급받아 저장 (expiresIn 30m)\n    // 서버쪽 토큰 유효성검사를 하는 미들웨어에서 토큰이 만료되었거나 없으면 403을 띄우면서 종료되어서\n    // App 컴포넌트에서 쓰이는 이 메소드와 아래의 signIn 메소드를 따로 분리해서 만들었음.\n    async signInWithToken() {\n        this.setIsLogging(true);\n        try {\n            const token = localStorage.getItem('SerendyToken');\n            if (!token) {\n                this.setIsLogging(false);\n                return;\n            } else if (token) {\n                const response = await serendyRepository.signInWidthToken();\n                if ((response.data.message === 'Invalid Token')) { // 토큰만료 또는 없음\n                    this.setIsLogging(false);\n                    return;\n                } else if ((response.data.message === 'SignIn Success')) {\n                    this.setUser({\n                        account: response.data.account,\n                        nickName: response.data.nickName,\n                    });\n                    this.setIsSignIn(true);\n                    localStorage.setItem('SerendyToken', response.data.token);\n                    this.setIsLogging(false);\n                }\n            }\n        } catch(err) {\n            this.setIsLogging(false);\n            alert('서버 점검중입니다')\n        }\n    }\n\n    async signIn(userData: ISignInData, setError: () => void, push: () => void): Promise<void> {\n        this.setIsLogging(true);\n        try {\n            const response = await serendyRepository.signIn(userData);\n            if ((response.data.message === 'SignIn Fail')) {\n                this.setIsLogging(false);\n                setError();\n            } else if ((response.data.message === 'SignIn Success')) {\n                this.setUser({\n                    account: response.data.account,\n                    nickName: response.data.nickName,\n                });\n                this.setIsSignIn(true);\n                localStorage.setItem('SerendyToken', response.data.token);\n                this.setIsLogging(false);\n                push();\n            }\n        } catch(err) {\n            console.log(5);\n            this.setIsLogging(false);\n            alert('서버 점검중입니다');\n        }\n    }\n\n    signOut(push: () => void): void {\n        this.setIsSignIn(false);\n        this.setUser({ account: null, nickName: null });\n        localStorage.removeItem('SerendyToken');\n        push();\n    }\n\n    async changePW(data: IPassword, push: () => void): Promise<void> {\n        try {\n            const response = await serendyRepository.changePassword(data);\n            if ((response.data.message === 'Changed')) {\n                alert(`비밀번호가 변경되었습니다\\n다시 로그인 해주세요`);\n                this.signOut(push);\n            }\n        } catch(err) {\n            alert('서버가 점검중이에요');\n        };\n    };\n\n    async changeName(nickName: INickName, push: () => void): Promise<void> {\n        try {\n            const response = await serendyRepository.changeName(nickName);\n            if ((response.data.message === 'Changed')) {\n                alert(`닉네임이 변경되었습니다\\n다시 로그인 해주세요`)\n                this.signOut(push);\n            }\n        } catch(err) {\n            console.log(err);\n            alert('서버가 점검중이에요');\n        };\n    };\n};\n\nconst userStore = new UserStore();\nexport default userStore;"]},"metadata":{},"sourceType":"module"}